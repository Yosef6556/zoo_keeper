<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>×¡×•×›×Ÿ ×”×¨×—×‘×ª ×“×™×¨×” ğŸ </title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Segoe UI', Arial, sans-serif;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
      min-height: 100vh;
      color: #f0f0f0;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 30px 16px;
    }
    h1 { font-size: 2rem; color: #f0c040; margin-bottom: 6px; text-align: center; text-shadow: 0 2px 12px #f0c04055; }
    .subtitle { color: #aaa; margin-bottom: 30px; text-align: center; font-size: 1rem; }
    .card {
      background: rgba(255,255,255,0.06);
      border: 1.5px solid #f0c04033;
      border-radius: 18px;
      padding: 28px 24px;
      width: 100%;
      max-width: 700px;
      margin-bottom: 24px;
      backdrop-filter: blur(8px);
    }
    .upload-area {
      border: 2.5px dashed #f0c04066;
      border-radius: 14px;
      padding: 32px;
      text-align: center;
      cursor: pointer;
      transition: background 0.2s, border-color 0.2s;
      margin-bottom: 16px;
    }
    .upload-area:hover { background: rgba(240,192,64,0.07); border-color: #f0c040; }
    .upload-area input[type="file"] { display: none; }
    .upload-area label { cursor: pointer; display: flex; flex-direction: column; align-items: center; gap: 10px; width: 100%; height: 100%; }
    .upload-icon { font-size: 2.5rem; }
    .upload-text { color: #f0c040; font-size: 1.05rem; font-weight: bold; }
    .upload-hint { color: #999; font-size: 0.88rem; }
    #preview-img { max-width: 100%; max-height: 320px; border-radius: 12px; border: 2px solid #f0c04066; margin-top: 14px; display: none; }
    .question-area { margin-top: 10px; }
    .question-area textarea {
      width: 100%; padding: 12px; border-radius: 10px;
      border: 1.5px solid #f0c04055; background: rgba(255,255,255,0.07);
      color: #f0f0f0; font-size: 1rem; font-family: inherit;
      resize: vertical; min-height: 80px; outline: none; transition: border-color 0.2s;
    }
    .question-area textarea:focus { border-color: #f0c040; }
    .question-area textarea::placeholder { color: #888; }
    .analyze-btn {
      width: 100%; margin-top: 16px; padding: 14px;
      background: linear-gradient(90deg, #f0c040, #e0a020);
      color: #1a1a2e; font-size: 1.1rem; font-weight: bold;
      border: none; border-radius: 10px; cursor: pointer;
      transition: opacity 0.2s, transform 0.1s;
    }
    .analyze-btn:hover { opacity: 0.92; transform: scale(1.01); }
    .analyze-btn:disabled { opacity: 0.5; cursor: not-allowed; }
    .response-card {
      display: none;
      background: rgba(240,192,64,0.06);
      border: 1.5px solid #f0c04044;
      border-radius: 14px; padding: 22px 20px;
      width: 100%; max-width: 700px; margin-bottom: 24px;
      line-height: 1.75; font-size: 1rem; white-space: pre-wrap;
    }
    .response-title { color: #f0c040; font-weight: bold; font-size: 1.1rem; margin-bottom: 12px; display: flex; align-items: center; gap: 8px; }
    .chat-section { display: none; width: 100%; max-width: 700px; }
    .chat-history {
      background: rgba(255,255,255,0.04); border: 1.5px solid #f0c04022;
      border-radius: 14px; padding: 16px; max-height: 300px;
      overflow-y: auto; margin-bottom: 12px;
    }
    .chat-msg { margin-bottom: 14px; display: flex; flex-direction: column; }
    .chat-msg.user .bubble { background: #f0c04022; border: 1px solid #f0c04044; align-self: flex-start; border-radius: 12px 12px 12px 2px; }
    .chat-msg.ai .bubble { background: rgba(255,255,255,0.06); border: 1px solid #ffffff22; align-self: flex-end; border-radius: 12px 2px 12px 12px; }
    .bubble { padding: 10px 14px; max-width: 85%; font-size: 0.97rem; line-height: 1.6; white-space: pre-wrap; }
    .bubble-label { font-size: 0.78rem; color: #888; margin-bottom: 3px; }
    .chat-input-row { display: flex; gap: 10px; }
    .chat-input-row input {
      flex: 1; padding: 12px 14px; border-radius: 10px;
      border: 1.5px solid #f0c04055; background: rgba(255,255,255,0.07);
      color: #f0f0f0; font-size: 1rem; font-family: inherit; outline: none;
    }
    .chat-input-row input:focus { border-color: #f0c040; }
    .chat-input-row input::placeholder { color: #888; }
    .chat-send-btn {
      padding: 12px 20px; background: #f0c040; color: #1a1a2e;
      font-weight: bold; border: none; border-radius: 10px;
      cursor: pointer; font-size: 1rem; transition: opacity 0.2s;
    }
    .chat-send-btn:hover { opacity: 0.88; }
    .chat-send-btn:disabled { opacity: 0.5; cursor: not-allowed; }
    .loader { display: none; text-align: center; color: #f0c040; font-size: 0.95rem; margin-top: 10px; animation: pulse 1.2s infinite; }
    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.4; } }
    .error-msg { color: #ff6b6b; font-size: 0.93rem; margin-top: 8px; display: none; }
  </style>
</head>
<body>
  <h1>ğŸ  ×¡×•×›×Ÿ ×”×¨×—×‘×ª ×“×™×¨×”</h1>
  <p class="subtitle">×”×¢×œ	×™ ×©×¨×˜×•×˜ ×©×œ ×”×“×™×¨×” ×©×œ×š ×•×§×‘×œ ×”××œ×¦×•×ª ××•×ª×××•×ª ××™×©×™×ª ×œ×”×¨×—×‘×”</p>

  <div class="card">
    <div class="upload-area">
      <label for="file-input">
        <input type="file" id="file-input" accept="image/*" />
        <span class="upload-icon">ğŸ“</span>
        <span class="upload-text">×œ×—×¥ ×œ×”×¢×œ××ª ×©×¨×˜×•×˜ ×”×“×™×¨×”</span>
        <span class="upload-hint">×ª×•××š ×‘-JPG, PNG, GIF, WEBP</span>
      </label>
    </div>
    <img id="preview-img" alt="×ª×¦×•×’×” ××§×“×™××”" />
    <div class="question-area">
      <textarea id="user-question" placeholder="××” ×ª×¨×¦×” ×œ×“×¢×ª? ×œ×“×•×’××”: ××™×œ×• ×§×™×¨×•×ª × ×™×ª×Ÿ ×œ×”×¨×•×¡? ××™×š ××¤×©×¨ ×œ×”×¨×—×™×‘ ××ª ×”×¡×œ×•×Ÿ?"></textarea>
    </div>
    <button class="analyze-btn" id="analyze-btn" disabled>ğŸ” × ×ª×— ××ª ×”×©×¨×˜×•×˜</button>
    <div class="loader" id="loader">â³ ×× ×ª×— ××ª ×”×©×¨×˜×•×˜, ×× × ×”××ª×Ÿ...</div>
    <div class="error-msg" id="error-msg"></div>
  </div>

  <div class="response-card" id="response-card">
    <div class="response-title">ğŸ¤– ×”××œ×¦×•×ª ×”×¡×•×›×Ÿ:</div>
    <div id="response-text"></div>
  </div>

  <div class="chat-section" id="chat-section">
    <div class="card" style="padding:18px 16px;">
      <div class="response-title" style="margin-bottom:12px;">ğŸ’¬ ×©××œ ×©××œ×•×ª × ×•×¡×¤×•×ª</div>
      <div class="chat-history" id="chat-history"></div>
      <div class="chat-input-row">
        <input type="text" id="chat-input" placeholder="×©××œ ×©××œ×” × ×•×¡×¤×ª ×¢×œ ×”×“×™×¨×”..." onkeydown="if(event.key==='Enter') sendChat()" />
        <button class="chat-send-btn" id="chat-send-btn" onclick="sendChat()">×©×œ×—</button>
      </div>
      <div class="loader" id="chat-loader">â³ ××—×©×‘ ×ª×©×•×‘×”...</div>
    </div>
  </div>

  <script>
    const API_KEY = 'AIzaSyDau-FNj1RKKyLN4iHg8Ys0j3fZG_GqMxs';
    const API_URL = 'https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=' + API_KEY;

    let base64Image = '';
    let imageMimeType = '';
    let conversationHistory = [];

    document.getElementById('file-input').addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (!file) return;
      imageMimeType = file.type;
      const reader = new FileReader();
      reader.onload = function(ev) {
        base64Image = ev.target.result.split(',')[1];
        const preview = document.getElementById('preview-img');
        preview.src = ev.target.result;
        preview.style.display = 'block';
        document.getElementById('analyze-btn').disabled = false;
      };
      reader.readAsDataURL(file);
    });

    document.getElementById('analyze-btn').addEventListener('click', analyzeImage);

    async function analyzeImage() {
      const question = document.getElementById('user-question').value.trim() ||
        '×× × × ×ª×— ××ª ×©×¨×˜×•×˜ ×”×“×™×¨×” ×”×–×” ×•×ª×Ÿ ×”××œ×¦×•×ª ××¤×•×¨×˜×•×ª ×›×™×¦×“ × ×™×ª×Ÿ ×œ×”×¨×—×™×‘ ××•×ª×”. ×›×œ×•×œ: ×§×™×¨×•×ª ×©× ×™×ª×Ÿ ×œ×”×¨×•×¡, ×ª×•×¡×¤×•×ª ××¤×©×¨×™×•×ª, ×©×™×¤×•×¨×™× ×œ×ª×›× ×•×Ÿ ×”××¨×—×‘, ×•×”×¢×¨×›×ª ×¢×œ×•×™×•×ª ×›×œ×œ×™×ª.';
      showLoader(true);
      hideError();
      document.getElementById('analyze-btn').disabled = true;
      const body = {
        contents: [{ parts: [
          { inlineData: { mimeType: imageMimeType, data: base64Image } },
          { text: '××ª×” ××“×¨×™×›×œ ×•××•××—×” ×œ×©×™×¤×•×¥ ×“×™×¨×•×ª. ' + question }
        ]}],
        generationConfig: { temperature: 0.7, maxOutputTokens: 2048 }
      };
      try {
        const res = await fetch(API_URL, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(body) });
        const data = await res.json();
        if (data.error) throw new Error(data.error.message);
        const text = data.candidates[0].content.parts[0].text;
        document.getElementById('response-text').innerText = text;
        document.getElementById('response-card').style.display = 'block';
        document.getElementById('chat-section').style.display = 'block';
        conversationHistory = [{ role: 'user', text: question }, { role: 'ai', text: text }];
      } catch (err) {
        showError('×©×’×™××”: ' + err.message);
      } finally {
        showLoader(false);
        document.getElementById('analyze-btn').disabled = false;
      }
    }

    async function sendChat() {
      const input = document.getElementById('chat-input');
      const msg = input.value.trim();
      if (!msg) return;
      input.value = '';
      document.getElementById('chat-send-btn').disabled = true;
      document.getElementById('chat-loader').style.display = 'block';
      addChatBubble('user', msg);
      conversationHistory.push({ role: 'user', text: msg });
      const parts = [
        { inlineData: { mimeType: imageMimeType, data: base64Image } },
        ...conversationHistory.map(function(m) { return { text: (m.role === 'user' ? '××©×ª××©' : '××“×¨×™×›×œ') + ': ' + m.text }; })
      ];
      const body = { contents: [{ parts: parts }], generationConfig: { temperature: 0.7, maxOutputTokens: 1024 } };
      try {
        const res = await fetch(API_URL, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(body) });
        const data = await res.json();
        if (data.error) throw new Error(data.error.message);
        const text = data.candidates[0].content.parts[0].text;
        addChatBubble('ai', text);
        conversationHistory.push({ role: 'ai', text: text });
      } catch (err) {
        addChatBubble('ai', 'âš ï¸ ×©×’×™××”: ' + err.message);
      } finally {
        document.getElementById('chat-send-btn').disabled = false;
        document.getElementById('chat-loader').style.display = 'none';
      }
    }

    function addChatBubble(role, text) {
      const history = document.getElementById('chat-history');
      const msg = document.createElement('div');
      msg.className = 'chat-msg ' + role;
      msg.innerHTML = '<div class="bubble-label">' + (role === 'user' ? 'ğŸ‘¤ ××ª×”' : 'ğŸ¤– ×¡×•×›×Ÿ') + '</div><div class="bubble">' + text + '</div>';
      history.appendChild(msg);
      history.scrollTop = history.scrollHeight;
    }

    function showLoader(show) { document.getElementById('loader').style.display = show ? 'block' : 'none'; }
    function showError(msg) { const el = document.getElementById('error-msg'); el.innerText = msg; el.style.display = 'block'; }
    function hideError() { document.getElementById('error-msg').style.display = 'none'; }
  </script>
</body>
</html>